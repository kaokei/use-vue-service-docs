---
author: 三棵树
title: 如何在类组件中使用 setup
---

首先在 vue 中存在两种组件形式，一种是 Option 组件，即直接声明一个对象，然后配置固定的某些属性即代表一个组件。还有一种形式是类组件。

类组件本事是不被 vue 支持的，需要借助 vue-class-component 才能工作。还好 vue-class-component 也是 vue 官方支持的。

在 Option 组件中，我们可以直接配置 setup 属性。但是在类组件中，我们不能在类中直接写一个 setup 属性/或者 setup 函数。

实际上在类组件的类中只能写特定的属性和方法。比如生命周期函数，其他函数都相当于 Option 组件中的 methods 中定义的方法。

类组件中的属性则相当于 Option 组件中的 data 定义的数据。

我们可以发现，在 Option 组件还有其他的属性或者方法似乎不知道在什么地方定义了。

比如 watch 属性，computed 属性，setup 函数，props 属性，directives 属性，components 属性。

对于 computed 属性应该定义为类的 getter 方法。

对于 setup，则需要`import { setup } from 'vue-class-component'`，然后使用 setup 函数初始化类的属性。

对于 props 属性，则需要`class MyComponent extends Vue.with(SomeProps) {}`，可以[参考这里](https://github.com/vuejs/vue-class-component/issues/465)

其他的属性和函数都需要在`@Options`装饰器中定义。可以[参考这里](https://github.com/vuejs/vue-class-component/issues/406)

顺便提一句，我本以为在类组件中使用 setup，就像在 Option 组件中一样简单，直接在类中定义 setup 方法就可以了。但是实际上这样是行不通的。

如果我们在类组件中定义 setup 方法，那么最终会被 vue-class-component 覆盖掉。实际上 vue-class-component 内部会自动生成一个 setup 函数来收集数据。

所以需要使用 vue-class-component 提供的 setup 函数来延迟初始化类的属性。

根据官方 issue 来看，不能在类中定义 setup 方法的原因是，我们不能根据 setup 方法的返回值类型来修改类的类型。这里的意思是指 setup 的返回值应该设置为类的成员属性，我们可以在运行时做到这一点，但是在类型提示方面做不到。
